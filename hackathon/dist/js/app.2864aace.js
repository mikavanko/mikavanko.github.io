(function(e){function t(t){for(var r,a,s=t[0],c=t[1],l=t[2],d=0,f=[];d<s.length;d++)a=s[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&f.push(o[a][0]),o[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);u&&u(t);while(f.length)f.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={app:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/hackathon/dist/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"05af":function(e,t,n){"use strict";n("5d3e")},"073e":function(e,t,n){"use strict";n("afea")},1206:function(e,t,n){"use strict";n("bea5")},"1ae4":function(e,t,n){e.exports=n.p+"img/logo.2992eba1.svg"},2233:function(e,t,n){},"45b3":function(e,t,n){},"4d60":function(e,t,n){"use strict";n("2233")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[e._m(0),n("router-view")],1)},i=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"header"},[r("div",{staticClass:"wrapper"},[r("div",{staticClass:"header__logo"},[r("img",{attrs:{src:n("1ae4"),alt:"logo"}})]),r("div",{staticClass:"header__title"},[e._v("Сервис распознавания аудио")])])])}],a={name:"App",metaInfo:{title:"Default Title",titleTemplate:"%s | My Awesome Webapp"}},s=a,c=(n("5c0b"),n("2877")),l=Object(c["a"])(s,o,i,!1,null,null,null),u=l.exports,d=n("8c4f"),f=n("2f62"),p=n("bc3a"),m=n.n(p),g=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"home"},[r("div",{staticClass:"wrapper"},[r("div",{staticClass:"form__wrapper"},[r("img",{staticClass:"form__img",attrs:{src:n("597f"),alt:"voice"}}),r("Form",{staticClass:"form",on:{submit:e.submitForm}})],1),e.files.length?r("UploadedList",{attrs:{files:e.files},on:{"update-storage":e.updateStorage,"recognition-finished":e.recognitionFinished,"recognition-started":e.recognitionStarted,"remove-from-files":e.removeFromFiles}}):e._e()],1)])},h=[],v=n("2909"),_=n("b85c"),b=n("1da1"),y=(n("96cf"),n("c740"),n("a434"),n("7db0"),n("99af"),n("b0c0"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("form",{staticClass:"form",attrs:{action:"https://storage.googleapis.com/hakathon",enctype:"multipart/form-data"},on:{submit:e.submit}},[n("label",{staticClass:"form__upload"},[n("input",{staticClass:"form__upload__hide",attrs:{name:"file",type:"file",accept:".mp3",multiple:""},on:{change:e.handleFileUpload}}),e._v(" Загрузить файл в .mp3 ")])])}),w=[],x={name:"Form",props:{},data:function(){return{files:null}},methods:{handleFileUpload:function(e){this.files=e.target.files,this.submit()},submit:function(){this.$emit("submit",this.files)}}},k=x,C=(n("a346"),Object(c["a"])(k,y,w,!1,null,"53550649",null)),I=C.exports,E=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("table",{staticClass:"list"},[e._m(0),e._l(e.files,(function(t,r){return n("UploadedListRow",{key:"row-"+r,attrs:{file:t},on:{"update-storage":function(t){return e.$emit("update-storage",t)},"recognition-finished":function(t){return e.$emit("recognition-finished",t)},"recognition-started":function(t){return e.$emit("recognition-started",t)},"remove-from-files":function(t){return e.$emit("remove-from-files",{idx:r,operationId:t})}}})}))],2)},S=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("tr",[n("th",[e._v("Размер файла")]),n("th",[e._v("Названия файла")]),n("th",[e._v("Статус")]),n("th",[e._v("Результат")])])}],O=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("tr",{staticClass:"row"},[n("td",{staticClass:"row__item size"},[e._v(" "+e._s(e.bytesToSize(e.file.size))+" ")]),n("td",{staticClass:"row__item name"},[e._v(" "+e._s(e.file.name)+" ")]),n("td",{staticClass:"row__item status"},[e.isError?[e._m(1)]:[e.isLoading||e.isError?e.isRecognized||e.isError?e.isError?e._e():[e._m(0)]:[n("div",{staticClass:"progress"},[n("div",{staticClass:"progress__text"},[e._v(" Распознавание "+e._s(e.percent)+"% ")]),n("div",{staticClass:"progress__bar"},[n("div",{staticClass:"progress__value",style:"width: "+e.percent+"%"})])])]:[n("div",{staticClass:"status__loading"},[e._v("Загрузка...")])]]],2),n("td",{staticClass:"row__item result"},[!e.isError&&e.operationId?n("button",{staticClass:"result__btn result__btn_open",attrs:{disabled:!e.isOpen},on:{click:e.open}},[e._v(" Скачать docx ")]):e._e(),e.operationId?n("button",{staticClass:"result__btn result__btn_remove",on:{click:e.remove}},[e._v(" Удалить ")]):e._e()])])},j=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"status__recognized"},[r("img",{attrs:{src:n("6aa8"),alt:"check"}}),e._v(" Распознано ")])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"status__error"},[r("img",{attrs:{src:n("6dac"),alt:"error"}}),e._v(" Ошибка ")])}],z=(n("d3b7"),{state:{recognizedList:[],controller:new AbortController},mutations:{setRecognizedList:function(e,t){e.recognizedList.push(t)}},actions:{setRecognizedList:function(e,t){var n=e.commit;n("setRecognizedList",t)}},getters:{getRecognizedList:function(e){return e.recognizedList},getRecognizedItem:function(e){return function(t){return e.recognizedList.find((function(e){return e.name===t}))}},getController:function(e){return e.controller}}}),$="d4eridc8huj6c6crgnpu",R=function(e,t){var n=t.params;return e.$axios.post("https://storage.googleapis.com/hakathon",n)},L=function(e,t){var n=t.params;return fetch("https://functions.yandexcloud.net/".concat($,"?action=").concat(n.action,"&file=").concat(n.file),{method:"post"}).then((function(e){return e.json()}))},M=function(e,t){var n=t.params;return fetch("https://functions.yandexcloud.net/".concat($,"?action=").concat(n.action,"&operationId=").concat(n.operationId),{method:"get",signal:z.getters.getController.signal}).then((function(e){return e.json()}))},U=1e3,F={name:"UploadedListRow",props:{file:{type:Object,default:function(){}}},data:function(){return{isOpen:!1,isLoading:!1,isRecognized:!1,percent:0,isError:!1,operationId:null,flag:!1,docxUrl:""}},computed:{},mounted:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.operationId=e.file.operationId||null,e.file.finished){t.next=18;break}if(n=new FormData,e.operationId){t.next=14;break}return e.isLoading=!1,n.append("key",e.file.name),console.log("this.file",e.file),n.append("file",e.file.file),t.next=10,R(e,{params:n}).catch((function(t){e.isError=!0,console.log(t)}));case 10:return t.next=12,e.recognizeFile(n).catch((function(t){e.isError=!0,console.log(t)}));case 12:r=t.sent,console.log("recognizeFile Error",r);case 14:e.isLoading=!0,e.isError||e.pollData(e.checkProgress,function(){var t=Object(b["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$emit("update-storage",{docxUrl:n.docxUrl,operationId:e.operationId}),e.docxUrl=n.docxUrl,e.isRecognized=!0,e.isOpen=!0;case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.next=22;break;case 18:e.isLoading=!0,e.isRecognized=!0,e.isOpen=!0,e.docxUrl=e.file.docxUrl;case 22:case"end":return t.stop()}}),t)})))()},methods:{remove:function(e){e.preventDefault(),this.$store.getters.getController.abort(),this.flag=!1,this.$emit("remove-from-files",this.operationId)},open:function(){this.isOpen&&window.open(this.docxUrl)},bytesToSize:function(e){var t=["Bytes","KB","MB","GB","TB"];if(0==e)return"0 Byte";var n=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,n),2)+" "+t[n]},recognizeFile:function(e){var t=this,n={action:"recognize",file:e.get("key")};return L(this,{params:n}).then((function(e){t.operationId=e.operationId,e.operationId?t.$emit("recognition-started",{name:t.file.name,size:t.file.size,operationId:e.operationId}):(t.isError=!0,t.flag=!1)})).catch((function(e){t.isError=!0,console.log(e)}))},sleep:function(e){return new Promise((function(t){return setTimeout(t,e)}))},pollData:function(e,t){var n=this;return Object(b["a"])(regeneratorRuntime.mark((function r(){var o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n.flag=!0;case 1:if(!n.flag){r.next=11;break}return r.next=4,e();case 4:return o=r.sent,n.percent=o.percent,o.done&&(n.flag=!1,t(o)),r.next=9,n.sleep(U);case 9:r.next=1;break;case 11:case"end":return r.stop()}}),r)})))()},checkProgress:function(){var e=this,t={action:"check",operationId:this.operationId};return M(this,{params:t}).catch((function(t){console.log("checkProgress Error"),e.isError=!0,e.flag=!1,console.log(t)}))}}},P=F,D=(n("4d60"),Object(c["a"])(P,O,j,!1,null,"0e26e80e",null)),T=D.exports,J={name:"UploadedList",props:{files:{type:Array,default:function(){return[]}}},components:{UploadedListRow:T}},N=J,A=(n("1206"),Object(c["a"])(N,E,S,!1,null,"aa1a345c",null)),B=A.exports,H={name:"Home",components:{Form:I,UploadedList:B},data:function(){return{files:[]}},mounted:function(){this.files=JSON.parse(localStorage.getItem("recData"))||[],console.log(this.files)},methods:{removeFromStorage:function(e,t){var n=JSON.parse(localStorage.getItem(t));if(n&&n.length){var r=n.findIndex((function(t){return t.operationId===e}));n.splice(r,1),this.recData=n,localStorage.setItem(t,JSON.stringify(n))}},removeFromFiles:function(e){var t=e.idx,n=e.operationId;this.files&&this.files.length&&(this.files.splice(t,1),this.removeFromStorage(n,"recData"),this.removeFromStorage(n,"recognizedItems"))},recognitionStarted:function(e){console.log("recognitionStarted",e);var t=JSON.parse(localStorage.getItem("recData"))||[];t.push(e),localStorage.setItem("recData",JSON.stringify(t))},recognitionFinished:function(e){console.log("recData",e),this.$store.dispatch("setRecognizedList",e);var t=JSON.parse(localStorage.getItem("recognizedItems"))||[],n=t.find((function(t){return t.operationId===e.operationId}));n||(t.push(e),localStorage.setItem("recognizedItems",JSON.stringify(t)))},updateStorage:function(e){var t=JSON.parse(localStorage.getItem("recData"))||[],n=t.findIndex((function(t){return t.operationId===e.operationId}));t[n].finished=!0,t[n].docxUrl=e.docxUrl,console.log("updateStorage",t),localStorage.setItem("recData",JSON.stringify(t))},submitForm:function(e){var t=this;return Object(b["a"])(regeneratorRuntime.mark((function n(){var r,o,i,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:console.log("submitForm"),r=[],o=Object(_["a"])(e);try{for(o.s();!(i=o.n()).done;)a=i.value,r.push({name:a.name,size:a.size,file:a,operationId:null})}catch(s){o.e(s)}finally{o.f()}t.files=[].concat(Object(v["a"])(t.files),r);case 5:case"end":return n.stop()}}),n)})))()}}},G=H,K=(n("95ef"),Object(c["a"])(G,g,h,!1,null,"31eb3cd3",null)),V=K.exports,W=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"edit-page"},[n("div",{staticClass:"wrapper"},[n("h2",{staticClass:"h2"},[e._v(e._s(e.title))]),e.audioUrl?n("player",{attrs:{url:e.audioUrl,timeStart:e.timeStart,timeEnd:e.timeEnd,isPlay:e.isPlay}}):e._e(),n("editor",{attrs:{"content-arr":e.content,play:e.onPlay}})],1)])},Y=[],Z=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"player"},[n("audio",{ref:"player",attrs:{controls:"",src:e.url}},[e._v(" Your browser does not support the "),n("code",[e._v("audio")]),e._v(" element. ")]),n("button",{on:{click:e.play}},[e._v("play")]),n("button",{on:{click:e.setSeek}},[e._v("seek")])])},q=[],Q=(n("a9e3"),{name:"Player",props:{url:{type:String,default:""},timeStart:{type:Number,default:0},timeEnd:{type:Number,default:0},isPlay:{type:Boolean,default:!1}},data:function(){return{seek:0}},methods:{play:function(){this.$refs.player.play()},setSeek:function(){this.$refs.player.currentTime=3}}}),X=Q,ee=(n("073e"),Object(c["a"])(X,Z,q,!1,null,"743d259a",null)),te=ee.exports,ne=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"editor"},[n("editor",{ref:"editor",attrs:{"api-key":"no-api-key",init:e.options},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}}),n("br"),n("button",{on:{click:e.onClick}},[e._v("Load docx")])],1)},re=[],oe=(n("a15b"),n("d81d"),n("25f0"),n("3ca3"),n("ddb0"),n("2b3d"),n("9861"),n("ca72")),ie={name:"Editor",components:{editor:oe["a"]},props:{contentArr:{type:Array,default:function(){return null}}},data:function(){return{tinymce:null,editor:null,content:"",contextMenuElemClicked:null}},watch:{contentArr:function(e){this.content=e.map((function(e){var t=+e.startTime.seconds||0,n=+e.startTime.nanos||0,r=t+n.toString()[0]/10;return e.confidence<.6?'<span style="background-color: red;"><word time="'.concat(r,'">').concat(e.word,"</word></span>"):'<word time="'.concat(r,'">').concat(e.word,"</word>")})).join(" ")}},computed:{options:function(){return{selector:"textarea#contextmenu-section",height:500,plugins:["contextmenu"],contextmenu:"customItem1",contextmenu_never_use_native:!0,extended_valid_elements:"word[time]",custom_elements:"~word",init_instance_callback:this.initInstanceCallback,setup:this.init}}},methods:{updateContextMenu:function(e,t){var n=this;t.ui.registry.addIcon("fuck",'<svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">\n                                            <circle cx="7.5" cy="7.5" r="7.5" fill="#075050"/>\n                                            <path d="M9.75 7.06699C10.0833 7.25944 10.0833 7.74056 9.75 7.93301L6.75 9.66506C6.41667 9.85751 6 9.61695 6 9.23205V5.76795C6 5.38305 6.41667 5.14249 6.75 5.33494L9.75 7.06699Z" fill="white"/>\n                                            </svg>\n                                          '),t.ui.registry.addMenuItem("customItem1",{icon:"fuck",text:"Проиграть",onAction:function(){var r=t.selection.getContent(),o=document.createElement("div");o.innerHTML=r,console.log("SELECTED",o.children),console.log("vue",e),o.children.length?e.$emit("play",{timeStart:o.children[0].getAttribute("time"),timeEnd:o.children[o.children.length-1].getAttribute("time")}):e.$emit("play",{timeStart:n.contextMenuElemClicked,timeEnd:n.contextMenuElemClicked})}})},init:function(e){var t=this;e.on("init",(function(){this.editor=e,this.tinymce=tinymce,t.updateContextMenu(t,this.editor)}))},initInstanceCallback:function(e){var t=this;e.on("click",(function(e){console.log("Element clicked:",e.target)})),e.on("ContextMenu",(function(e){t.contextMenuElemClicked=e.target,console.log("ContextMenu Element clicked:",e.target)}))},downloadBlob:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"file.docx",n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=t,document.body.appendChild(r),r.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),document.body.removeChild(r)},onClick:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log(e.editor,e.tinymce);case 1:case"end":return t.stop()}}),t)})))()}}},ae=ie,se=(n("58d3"),Object(c["a"])(ae,ne,re,!1,null,null,null)),ce=se.exports,le={name:"Edit",components:{Editor:ce,Player:te},data:function(){return{isPlay:!1,item:null,timeStart:null,timeEnd:null}},mounted:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=JSON.parse(localStorage.getItem("recognizedItems"))||[],r=e.$route.params.id,n.length?e.item=n.find((function(e){return e.name===r})):e.item=e.$store.getters.getRecognizedItem(r);case 3:case"end":return t.stop()}}),t)})))()},methods:{onPlay:function(e){console.log("onPlay"),console.log(e)}},computed:{title:function(){var e,t;return null!==(e=null===(t=this.item)||void 0===t?void 0:t.name)&&void 0!==e?e:""},audioUrl:function(){return this.item?"https://storage.googleapis.com/hakathon/".concat(this.item.name):""},content:function(){var e,t;return null!==(e=null===(t=this.item)||void 0===t?void 0:t.data)&&void 0!==e?e:[]}}},ue=le,de=(n("05af"),Object(c["a"])(ue,W,Y,!1,null,"a5c9af06",null)),fe=de.exports,pe=[{path:"/",component:V},{path:"/:id",component:fe}],me=n("dad5"),ge=n.n(me);r["a"].use(ge.a),r["a"].prototype.$axios=m.a,r["a"].use(f["a"]),r["a"].use(d["a"]);var he=new f["a"].Store(z),ve=new d["a"]({routes:pe,mode:"history",base:"/hackathon/dist/"});r["a"].config.productionTip=!1,new r["a"]({store:he,router:ve,render:function(e){return e(u)}}).$mount("#app")},"58d3":function(e,t,n){"use strict";n("f08e")},"597f":function(e,t,n){e.exports=n.p+"img/voice.18be549a.jpg"},"5c0b":function(e,t,n){"use strict";n("9c0c")},"5d3e":function(e,t,n){},"6aa8":function(e,t,n){e.exports=n.p+"img/check.092606bb.svg"},"6dac":function(e,t,n){e.exports=n.p+"img/error.48729688.svg"},"786c":function(e,t,n){},"95ef":function(e,t,n){"use strict";n("786c")},"9c0c":function(e,t,n){},a346:function(e,t,n){"use strict";n("45b3")},afea:function(e,t,n){},bea5:function(e,t,n){},f08e:function(e,t,n){}});
//# sourceMappingURL=app.2864aace.js.map